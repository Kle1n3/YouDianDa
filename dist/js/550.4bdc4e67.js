"use strict";(self["webpackChunkydd"]=self["webpackChunkydd"]||[]).push([[550],{7550:function(t,e,a){a.r(e),a.d(e,{default:function(){return _}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"release-container"},[t.token?e("div",{staticClass:"login"},[e("van-form",{attrs:{id:"pubarticle"}},[e("van-field",{attrs:{name:"article_name",label:"文章标题",placeholder:"请输入文章标题",rules:[{required:!0,message:"请输入文章标题"}]},model:{value:t.article_name,callback:function(e){t.article_name=e},expression:"article_name"}}),e("van-field",{attrs:{name:"article_cate",label:"文章分类",placeholder:"请选择文章分类",rules:[{required:!0,message:"请选择文章分类"}]},on:{click:function(e){t.isCateShow=!0}},model:{value:t.article_cate,callback:function(e){t.article_cate=e},expression:"article_cate"}}),e("van-popup",{style:{height:"30%"},attrs:{position:"bottom"},model:{value:t.isCateShow,callback:function(e){t.isCateShow=e},expression:"isCateShow"}},[e("van-picker",{attrs:{title:"文章分类","show-toolbar":"",columns:t.cateList},on:{confirm:t.onConfirmCate,cancel:t.onCancel}})],1),e("van-field",{attrs:{name:"article_tage",label:"文章标签",placeholder:"请选择文章标签",rules:[{required:!0,message:"请选择文章标签"}]},on:{click:function(e){t.isTageShow=!0}},model:{value:t.article_tage,callback:function(e){t.article_tage=e},expression:"article_tage"}}),e("van-popup",{style:{height:"30%"},attrs:{position:"bottom"},model:{value:t.isTageShow,callback:function(e){t.isTageShow=e},expression:"isTageShow"}},[e("van-picker",{attrs:{title:"文章标签","show-toolbar":"",columns:t.tageList},on:{confirm:t.onConfirmTage,cancel:t.onCancel}})],1),e("van-field",{attrs:{name:"fileList",label:"文件上传",rules:[{required:!0}]},scopedSlots:t._u([{key:"input",fn:function(){return[e("van-uploader",{model:{value:t.fileList,callback:function(e){t.fileList=e},expression:"fileList"}})]},proxy:!0}])}),e("van-field",{attrs:{rows:"3",autosize:"",label:"文章正文",type:"textarea",placeholder:"请输入文章正文",rules:[{required:!0,message:"请输入文章正文"}]},model:{value:t.article_content,callback:function(e){t.article_content=e},expression:"article_content"}}),t.$route.query.id?e("div",{staticClass:"btn",staticStyle:{margin:"16px"}},[e("van-button",{attrs:{icon:"send-gift-o",type:"info"},on:{click:t.saveAsDraft}},[t._v("存草稿")]),e("van-button",{attrs:{icon:"plus",type:"warning"},on:{click:t.edit}},[t._v("修改文章")]),e("van-button",{attrs:{icon:"revoke",type:"danger"},on:{click:t.reset}},[t._v("重置")])],1):e("div",{staticClass:"btn",staticStyle:{margin:"16px"}},[e("van-button",{attrs:{icon:"plus",type:"primary"},on:{click:t.release}},[t._v("发布")]),e("van-button",{attrs:{icon:"send-gift-o",type:"info"},on:{click:t.saveArt}},[t._v("存草稿")]),e("van-button",{attrs:{icon:"revoke",type:"danger"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1):e("div",{staticClass:"nologin"},[e("van-empty",{attrs:{image:"error",description:"请登录"}})],1)])},c=[],s=a(3822),l=a(7095),n=a(4471);const o=t=>(0,n.Z)({url:"/home/common/upload?type=images",method:"post",headers:{contentType:"multipart/form-data; boundary=----WebKitFormBoundaryih2B8xtAogLAoAvt"},data:t}),r=t=>(0,n.Z)({method:"post",url:"/home/user/addArticle",data:t}),h=t=>(0,n.Z)({url:"/home/index/show",params:t}),d=t=>(0,n.Z)({method:"post",url:"/home/user/editArticle",data:t});var u={name:"Release",data(){return{article_name:"",article_cate:"",isCateShow:!1,cateList:[],article_tage:"",isTageShow:!1,tageList:[],fileList:[],article_content:"",allCate:[],articleInfo:{},id:this.$route.query.id}},computed:{...(0,s.Se)(["token"])},created(){this.token&&this.initData()},methods:{async initData(){try{const{data:t}=await(0,l.w)();if(this.allCate=t.data.allCate,t.data.allCate.forEach((t=>{this.cateList.push(t.catename)})),t.data.allTag.forEach((t=>{this.tageList.push(t.tagname)})),this.$route.query.id){const{data:t}=await h({id:this.$route.query.id});this.articleInfo=t.data.info,this.article_name=t.data.info.title,this.article_cate=t.data.info.catename,this.article_tage=t.data.info.tags,this.article_content=t.data.info.content}}catch(t){console.log(t)}},onConfirmCate(t,e){this.article_cate=t,this.isCateShow=!1},onConfirmTage(t,e){this.article_tage=t,this.isTageShow=!1},onCancel(){this.isCateShow=!1,this.isTageShow=!1},async release(){try{await this.$refs.form.validate(["article_name","article_cate","article_cate","fileList","article_content"])}catch(t){console.log(t)}try{let t=new FormData;t.append("file",this.fileList[0].file);const{data:e}=await o(t),a=e.data.savePath;this.allCate.forEach((t=>{t.catename===this.article_cate&&(cateid=t.id)})),await r({author:"",cateid:cateid,content:this.article_content,pic:a,status:"2",tags:this.article_tage,title:this.article_name}),this.$toast.success("发布成功"),this.$router.push("/article")}catch(t){console.log(t)}},async saveArt(){try{await this.$refs.form.validate(["article_name","article_cate","article_cate","fileList","article_content"])}catch(t){console.log(t)}try{let t=new FormData;t.append("file",this.fileList[0].file);const{data:e}=await o(t),a=e.data.savePath;let i=0;this.allCate.forEach((t=>{t.catename===this.article_cate&&(i=t.id)})),await r({author:"",cateid:i,content:this.article_content,pic:a,status:"1",tags:this.article_tage,title:this.article_name}),this.$toast.success("保存成功"),this.$router.push("/article")}catch(t){console.log(t)}},async edit(){try{await this.$refs.form.validate(["article_name","article_cate","article_cate","article_content"])}catch(t){console.log(t)}try{if(this.fileList.length>0){let t=new FormData;t.append("file",this.fileList[0].file);const{data:e}=await o(t);this.articleInfo.pic=e.data.savePath}this.allCate.forEach((t=>{t.catename===this.article_cate&&(this.articleInfo.cateid=t.id)})),this.articleInfo.name=this.article_name,this.articleInfo.tags=this.article_tage,this.articleInfo.content=this.article_content,await d(this.articleInfo),this.$toast.success("修改文章成功"),this.$router.push("/article")}catch(t){console.log(t)}},async saveAsDraft(){try{await this.$refs.form.validate(["article_name","article_cate","article_cate","article_content"])}catch(t){console.log(t)}try{if(this.fileList.length>0){let t=new FormData;t.append("file",this.fileList[0].file);const{data:e}=await o(t);this.articleInfo.pic=e.data.savePath}this.allCate.forEach((t=>{t.catename===this.article_cate&&(this.articleInfo.cateid=t.id)})),this.articleInfo.name=this.article_name,this.articleInfo.tags=this.article_tage,this.articleInfo.content=this.article_content,await d(this.articleInfo),this.$toast.success("修改文章成功"),this.$router.push("/article")}catch(t){console.log(t)}},reset(){document.getElementById("pubarticle").reset(),this.fileList=[]}}},f=u,m=a(1001),p=(0,m.Z)(f,i,c,!1,null,"318d58e1",null),_=p.exports},7095:function(t,e,a){a.d(e,{w:function(){return c}});var i=a(4471);const c=()=>(0,i.Z)({url:"/home/index/index"})}}]);